import React, { useEffect, useRef } from 'react';

const ClickPayForm = () => {
    const iframeRef = useRef(null);

    useEffect(() => {
        if (iframeRef.current) {
            iframeRef.current.srcdoc = `
        <html>
          <head>
            <script src='https://secure.clickpay.com.sa/payment/js/paylib.js'></script>
          </head>
          <body>
            <form action='https://rcs-fa-dev.azurewebsites.net/api/ClientCollections/collectionViaClickPay' id='payform' method='post'>
              <span id='paymentErrors'></span>
              <div>
                <label>Card Number</label>
                <input type='text' data-paylib='number' size='20' />
              </div>
              <div>
                <label>Expiry Date (MM/YYYY)</label>
                <input type='text' data-paylib='expmonth' size='2' />
                <input type='text' data-paylib='expyear' size='4' />
              </div>
              <div>
                <label>Security Code</label>
                <input type='text' data-paylib='cvv' size='4' />
              </div>
              <input type='submit' value='Place order' />
              <script>
                var myform = document.getElementById('payform');
                paylib.inlineForm({
                  key: 'CNKMTR-RTP96B-6GRHBN-GGM7KV',
                  form: myform,
                  autoSubmit: true,
                  callback: function(response) {
                    document.getElementById('paymentErrors').innerHTML = '';
                    console.error(response);
                    if (response.error) {
                      paylib.handleError(document.getElementById('paymentErrors'), response);
                    }
                  }
                });
              </script>
            </form>
          </body>
        </html>
      `;
        }
    }, []);

    return (
        <iframe
            ref={iframeRef}
            title="ClickPay Payment Form"
            width="100%"
            height="600"
            className="rounded-2xl shadow border max-w-md mx-auto"
        ></iframe>
    );
};

export default ClickPayForm;
